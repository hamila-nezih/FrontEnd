<html>
   
   <head>
      <script src = "http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
   </head>
   
   <body ng-app = "myApp">
	  <div ng-controller = "myCtrl">
    <input type="file" file-model="code.myFile"/>
    <button ng-click="uploadFile()">upload me</button>
   </div> 
   <!-- <form ng-submit="uploadFile()" name="uploadForm" enctype="multipart/form-data">
    <input name="file" type="file" id="file" file-model="myFile" />
    <input type="submit" value="Envoyer" />
    </form>  -->
      
      <script>
      var myApp = angular.module('myApp', []);

      myApp.directive('fileModel', ['$parse', function ($parse) {
          return {
              restrict: 'A',
              link: function(scope, element, attrs) {
                  var model = $parse(attrs.fileModel);
                  var modelSetter = model.assign;
                  
                  element.bind('change', function(){
                      scope.$apply(function(){
                          modelSetter(scope, element[0].files[0]);
                      });
                  });
              }
          };
      }]);

      myApp.service('fileUpload', ['$http','$location', function ($http,$location) {
          this.uploadFileToUrl = function(files, uploadUrl){
               var file = new FormData();
               console.log(files.name);
              file.append('file', files);
              file.append('name', "files"); 
            /*   $http({
			          method  : 'POST',
			          url     : 'http://localhost:8081/stage/uploadFile',
			          data    : $.param({
					   file:   file
					   name:   "nnn"
					 }),{transformRequest: angular.identity,
		                  headers: {'Content-Type':undefined}}
				}).success(function(data, status, header) {
			        if("a"==="true"){
			            console.log("opa")
			        }
			    });  */   
           $http.post(uploadUrl,file, {
                  transformRequest: angular.identity,
                  headers: {'Content-Type':undefined}
              })
              .success(function(){
            	  $location.path('/user-list');
              })
              .error(function(){
            	 
              }); 
          }
      }]);

      myApp.controller('myCtrl', ['$scope', 'fileUpload', function($scope, fileUpload){
          
    	  $scope.code = {myFile: 'foo'};
          $scope.uploadFile = function(){
              var file = $scope.code.myFile;
              console.log('file is ' );
              console.dir(file);
              var uploadUrl = "http://localhost:8081/stage/uploadFile";
              fileUpload.uploadFileToUrl(file, uploadUrl);
          };
          
      }]);
      </script>
      
   </body>
</html>